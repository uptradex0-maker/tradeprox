<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
</head>
<body style="background: #0d1421; color: white; font-family: Arial; padding: 20px;">
    <h1>Admin Panel - Deposit Requests</h1>
    
    <div style="background: #1e2329; padding: 20px; margin: 20px 0; border-radius: 10px;">
        <h3>Pending Deposit Requests</h3>
        <div id="requestsList" style="max-height: 400px; overflow-y: auto; background: #2b2f36; padding: 10px; border-radius: 5px;">Loading...</div>
        <button onclick="loadRequests()" style="width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; background: #f0b90b; color: black;">Refresh Requests</button>
    </div>
    
    <script>
        function loadRequests() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/admin/requests', true);
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const data = JSON.parse(xhr.responseText);
                    const list = document.getElementById('requestsList');
                    
                    if (data.requests && data.requests.length > 0) {
                        list.innerHTML = data.requests.map(r => 
                            '<div style="padding: 15px; margin: 10px 0; background: #3c4043; border-radius: 5px; border-left: 5px solid ' + (r.status === 'pending' ? '#f0b90b' : r.status === 'approved' ? '#02c076' : '#f84960') + ';">' +
                                '<div><strong>User ID:</strong> ' + r.userId + '</div>' +
                                '<div><strong>Amount:</strong> â‚¹' + r.amount + '</div>' +
                                '<div><strong>UTR:</strong> ' + r.utr + '</div>' +
                                '<div><strong>Status:</strong> ' + r.status.toUpperCase() + '</div>' +
                                '<div><strong>Time:</strong> ' + new Date(r.timestamp).toLocaleString() + '</div>' +
                                (r.status === 'pending' ? 
                                    '<div style="margin-top: 10px;">' +
                                        '<button onclick="approveRequest(\'' + r.id + '\')" style="padding: 8px 16px; margin: 5px; border: none; border-radius: 5px; background: #02c076; color: white; cursor: pointer;">Approve</button>' +
                                        '<button onclick="rejectRequest(\'' + r.id + '\')" style="padding: 8px 16px; margin: 5px; border: none; border-radius: 5px; background: #f84960; color: white; cursor: pointer;">Reject</button>' +
                                    '</div>' : ''
                                ) +
                            '</div>'
                        ).join('');
                    } else {
                        list.innerHTML = 'No deposit requests found';
                    }
                }
            };
            
            xhr.send();
        }
        
        function approveRequest(requestId) {
            if (!confirm('Approve this deposit request?')) return;
            
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/admin/approve', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    const data = JSON.parse(xhr.responseText);
                    alert(data.success ? 'Request approved!' : 'Error: ' + data.message);
                    if (data.success) loadRequests();
                }
            };
            
            xhr.send(JSON.stringify({ requestId }));
        }
        
        function rejectRequest(requestId) {
            if (!confirm('Reject this deposit request?')) return;
            
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/admin/reject', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    const data = JSON.parse(xhr.responseText);
                    alert(data.success ? 'Request rejected!' : 'Error');
                    if (data.success) loadRequests();
                }
            };
            
            xhr.send(JSON.stringify({ requestId }));
        }
        
        // Auto-refresh every 30 seconds
        setInterval(loadRequests, 30000);
        
        // Load on page load
        window.onload = function() {
            loadRequests();
        };
    </script>
</body>
</html>